---
title: "Team Assignment - Our Fast Food Journey"
author: "The very best team - Group G"
date: '2020-10-24'
output:
  pdf_document: default
  html_document:
    df_print: paged
  word_document: default
fig_width: 4
fig_height: 2
---

## Introduction and data collection

We set out to collect information on 32cm Margherita pizza and 0.5l cola prices from various locations within Hungary by web-scraping the menus available on one of the biggest Hungarian food delivery sites called NetPincer. All codes and files used for this analysis are avaialbe in our [github repo](https://github.com/zsomborh/ba_da1/tree/master/group_g_assignments).

We chose web-scraping in order to reach the highest possible data coverage without selection bias and also to have high data-quality by reducing the chances of manual error. We scraped data from Pizzerias from the 5 largest Hungarian cities (Budapest, Debrecen, Szeged, Miskolc and Pecs). We collected every information that was available on the site (e.g. rating, number of ratings, address) on the restaurants, their advertised products and created geo locations from their addresses so that we can calculate their distance from the city center in an automated manner. 

We had 3 main challenges when cleaning the scraped data. We needed to **identify the correct product types** and We dropped all observations that were not Margherita pizzas or Colas. We also had to **identifying the exact products with exact features** which was not easy since Margherita pizzas existed in the data with different features (e.g. low carb, vegan, thin crusted, with olives etc...). We eliminitad all observations with such extra features. After that we **looked at 32cm and 0.5l containers only** and dropped observations with different sizes.

We tackled the above only by employing a number of transformations on a string variable which was the product description on the site. We also dropped any resulting duplicates to arrive to a tidy table. By that we entity-resolution and misambiguation thus had relatively high data quality. Unfortunately many restaurants didn't serve beverages or they served it in differnet sizes - in these cases we marked the beverage price with NA. 

## Descriptive statistics

Our dataframe holds 91 restaurants with Margherita pizza prices out of which only 28 served cola beverages in 0.5l containers as visible in Table 1. Figure 1 visualises the distribution of each price variable, from which we can see that the density plots are right-skewed with a local and a global maximum. We can see in Figure 2 that the two maximum exist due to average prices being generally higher in our Budapest sample than in the other large cities.

```{r, include = FALSE}
knitr::opts_chunk$set(fig.width=8, fig.height=4) 
```

```{r , include = FALSE}
library(tidyverse)
library(moments)
library(xtable)
library(ggpubr)
library(ggcorrplot)

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))

data_in <- "../data/clean/"
pizza_data <- read_csv(paste0(data_in,"assignment1_v2_2020-10-24_11_59.csv"))

pizza_data <- pizza_data %>% 
    mutate(distance_ceu = as.numeric(gsub('[^0-9\\.]','',distance_ceu)),
           distance_city_center = as.numeric(gsub('[^0-9\\.]','',distance_city_center)))
pizza_sum <- pizza_data %>% summarise(
    variable = 'Pizza prices',
    mean     = mean(margherita_pizza_price),
    median   = median(margherita_pizza_price),
    std      = sd(margherita_pizza_price),
    iq_range = IQR(margherita_pizza_price), 
    min      = min(margherita_pizza_price),
    max      = max(margherita_pizza_price),
    skew     = skewness(margherita_pizza_price),
    numObs   = sum( !is.na( margherita_pizza_price ) ) )
bev_sum  <- pizza_data %>% 
    filter(!is.na(beverage_price))  %>%
    summarise(
    variable = 'Beverage prices',
    mean     = mean(beverage_price),
    median   = median(beverage_price),
    std      = sd(beverage_price),
    iq_range = IQR(beverage_price), 
    min      = min(beverage_price),
    max      = max(beverage_price),
    skew     = skewness(beverage_price),
    numObs   = sum( !is.na( beverage_price ) ) )
price_summary <- pizza_sum %>% add_row( bev_sum ) 
xtb <- xtable(price_summary,type = "latex", caption = "Summary statistics of all observations ")
```

```{r , include = FALSE}
p1<- ggplot( pizza_data , aes( x = margherita_pizza_price ) ) +
    geom_histogram( aes(y = ..density..) , alpha = 1, binwidth = 100, color = 'black', fill = 'white') +
    geom_density( aes(y = ..density..) , alpha = .2 , bw = 100, color = 'black', fill="#FF6666") +
    labs(x='Margherita Pizza Prices (in HUF)',y='Density')
p2<- ggplot( pizza_data , aes( x = beverage_price ) ) +
    geom_histogram( aes(y = ..density..) , alpha = 1, binwidth = 30, color = 'black', fill = 'white') +
    geom_density( aes(y = ..density..) , alpha = .2 , bw = 30, color = 'black', fill="#56B4E9") +
    labs(x='Beverage Prices (in HUF)',y='Density')
```

```{r, echo = FALSE , results = "asis", warning = FALSE, message = FALSE }
print(xtb, comment=FALSE, include.rownames=FALSE)
```

```{r fig 1, fig.width=8,fig.height=1.5, fig.cap='Price distribution for beverages and pizzas for the whole population', echo = FALSE , results = "asis", warning = FALSE, message = FALSE }
ggarrange(p1, p2, nrow = 1 )
```

```{r , include = FALSE }
pizza_data <- pizza_data %>% 
    mutate(city = factor(city),
           city = ifelse(city=='Budapest','Budapest','Rest of Hungary'))
pizza_sum <- pizza_data %>% 
    select(city,margherita_pizza_price) %>% 
    group_by (city) %>% 
    summarise(
        variable = 'price_pizza',
        mean     = mean(margherita_pizza_price),
        median   = median(margherita_pizza_price),
        std      = sd(margherita_pizza_price),
        iq_range = IQR(margherita_pizza_price), 
        min      = min(margherita_pizza_price),
        max      = max(margherita_pizza_price),
        skew     = skewness(margherita_pizza_price),
        numObs   = sum( !is.na( margherita_pizza_price ) ) )
bev_sum  <- pizza_data %>% 
    filter(!is.na(beverage_price)) %>%
    select(city,beverage_price) %>% 
    group_by (city) %>% 
    summarise(
    variable = 'price_bev',
    mean     = mean(beverage_price),
    median   = median(beverage_price),
    std      = sd(beverage_price),
    iq_range = IQR(beverage_price, na.rm=TRUE), 
    min      = min(beverage_price),
    max      = max(beverage_price),
    skew     = skewness(beverage_price),
    numObs   = sum( !is.na( beverage_price ) ) )
price_summary <- pizza_sum %>% add_row( bev_sum ) 
```

```{r , include = FALSE}
p1<- ggplot( pizza_data , aes( x = margherita_pizza_price, fill = city, colour = city ) ) +
    geom_histogram( aes(y = ..density..) , alpha = .5, binwidth = 100, colour = 'gray')+
    geom_density( aes(y = ..density..) , alpha = .5 , bw = 100, color = 'black')+
    labs(x='Margherita Pizza Prices (in HUF)',y='Density') +
    scale_color_brewer(palette="Dark2")
p2 <- ggplot(pizza_data, aes(y = beverage_price, x = city)) +
    geom_boxplot(color = "blue", size = 0.5, width = 0.1, alpha = 0.5) +
    labs(x='Cities',y='Margherita Pizza Prices') + 
    stat_boxplot(geom = "errorbar", width = 0.05,  size = 0.5) + 
    stat_summary(fun=mean, geom="point", shape=20, size=5, color="red", fill="red")

```

```{r, echo = FALSE , fig.cap='Price distibution of pizza and beverage prices in Budapest and Rest of Hungary', results = "asis", warning = FALSE, message = FALSE , fig.height=2.2}
ggarrange(p1, p2, nrow = 1,common.legend = TRUE, legend="bottom")
```

\newpage

# Correlation

We wanted to measure the strength and direction of the linear relationships between the various variables in our data table such as price, distance to city center,beverage price, ratings and no of ratings. We drew up a correlation matrix for the two locations Budapest and Rest of Hungary which helped us summarize the relationships of the variables against each other in both locations.

```{r, echo=FALSE, fig.cap='Correlation Matrix (Budapest)', fig.height=3.7, message=FALSE, warning=FALSE, fig.width=8, results= 'asis'}
select_col <- pizza_data %>%
  filter(city == "Budapest") %>%
  select(user_rating,no_ratings,distance_ceu,margherita_pizza_price,beverage_price)

cor1 <- cor(select_col, use = "pairwise.complete.obs")
ggcorrplot(cor1, method = "square",lab = TRUE)
```

```{r, fig.width=8,fig.height=3.7, fig.cap='Correlation Matrix (Rest of Hungary)', echo = FALSE, warning = FALSE, message = FALSE, results = 'asis'}
select_col <- pizza_data %>%
  filter(city != "Budapest") %>%
  select(user_rating,no_ratings,distance_city_center,margherita_pizza_price,beverage_price)

cor2 <- cor(select_col, use = "pairwise.complete.obs")
ggcorrplot(cor2, method = "square",lab = TRUE)
```

\newpage

## Margherita pizza price vs distance to city center

In Budapest,we expected the pizza price to decrease as we moved away from the city center but the correlation of 0.03 shows that there is only a minute positive linear relationship between the two variables.The price difference in regards to distance might as well be characterized as zero. In Rest of Hungary, the price of the pizza decreased a little as we moved away from city center as shown by a negative correlation of 0.08. The scatterplot of the two variables along with a trend line further shows the relationship in the two groups locations.

```{r, fig.width=8,fig.height=3,fig.cap="Scatterplot of pizza price vs distance to city center in Budapest and Rest of Hungary", echo= FALSE, message= FALSE, warning = FALSE}
price_distance1 <- pizza_data %>%
  filter(city == 'Budapest') %>%
 ggplot(aes(x = distance_ceu, y = margherita_pizza_price)) + 
  geom_point() +
  geom_smooth(method = "lm") + theme_bw() + 
  labs(x= 'Distance to CEU', y = 'Margherita pizza price', subtitle = 'Budapest')

price_distance2 <- pizza_data %>%
  filter(city == 'Rest of Hungary') %>%
 ggplot(aes(x = distance_city_center, y = margherita_pizza_price)) + 
  geom_point() +
  geom_smooth(method = "lm") + theme_bw() + 
  labs(x= 'Distance to city center', y = 'Margherita pizza price',subtitle = 'Rest of Hungary')

ggarrange(price_distance1,price_distance2, nrow =1)
```

## Margherita pizza price vs User rating

In Budapest, the correlation of 0.1 shows that there is a very weak positive relationship between user ratings and pizza price in a restaurant. In Rest of Hungary, the correlation is 0.21 which also signifies a weak positive relationship. The rating for restaurants that had higher prices had a better user rating. Its most likely that the quality of ingredients and taste justified the higher price and hence customers gave a slightly higher rating.

```{r, fig.width=8,fig.height=3,fig.cap="Scatterplot of Margherita pizza price vs User rating in Budapest and Rest of Hungary", echo= FALSE, message= FALSE, warning = FALSE}
pizza_data %>%
  ggplot(aes(x = margherita_pizza_price, y = user_rating)) + 
  geom_point() +
  geom_smooth(method = "lm") + theme_bw() + 
  labs(x= 'Margherita pizza price', y = 'User Rating') +
  facet_wrap(~city)
```

## Distance to city center vs User rating

In Budapest, the restaurants closer to CEU (city center for Budapest) had comparatively higher ratings than the ones further away from CEU as shown by correlation of -0.31. Since many locals and tourists alike visit the city center more to eat, the restaurants aim to provide good quality food to maintain its reputation. Hence, it may be that the customers had a better experience in the city center. The number of observations related to restaurants far from city center are low so the relationship may not be entirely true and needs to be studied further.In Rest of Hungary, there is no noticeable pattern visible between distance to city center and user rating as shown by correlation of 0.03. It signifies a very weak positive correlation.

```{r, fig.width=8,fig.height=3, fig.cap="Scatterplot of Distance to city center vs User rating in Budapest and Rest of Hungary", echo= FALSE, message= FALSE, warning = FALSE}
ratings_distance1 <- pizza_data %>%
  filter(city == 'Budapest') %>%
 ggplot(aes(x = distance_ceu, y = user_rating)) + 
  geom_point() +
  geom_smooth(method = "lm") + theme_bw() + 
  labs(x= 'Distance to CEU', y = 'User ratings', subtitle = 'Budapest')

ratings_distance2 <- pizza_data %>%
  filter(city == 'Rest of Hungary') %>%
 ggplot(aes(x = distance_city_center, y = user_rating)) + 
  geom_point() +
  geom_smooth(method = "lm") + theme_bw() + 
  labs(x= 'Distance to city center', y = 'User ratings',subtitle = 'Rest of Hungary')

ggarrange(ratings_distance1,ratings_distance2, nrow =1)
```

# Hypothesis testing

## **Two sample t-test -** Analyzing 32 cm Margherita pizza prices

**Question**: Is the average price of marheritha is the same in Budapest vs. Rest of Hungary (other big cities: Debrecen, Szeged, Pécs, Miskolc)

**H0**: *avg. price of pizza in Budapest - avg. price of pizza outside of Budapest == 0* \
**H-Alternative**: *avg. price of in Budapest - avg. price outside of Budapest != 0*

We test for equality of average prices. We can reject N0, if p \< 0.05.

```{r, echo = FALSE, message = FALSE, warning = FALSE, include = FALSE }
t.test(margherita_pizza_price ~ city, pizza_data)
```

**Result**: t = 4.0079, df = 82.502, p-value = 0.0001337, 95 percent confidence interval: [134.9711; 400.9516].
The p-value is way smaller than the defined 5%, hence, we CAN reject the Null hypothesis. The probability of making a false positive error is about 0.013%. True difference in means is not equal to 0, hence avg. price of pizza in Budapest vs. avg. price of pizza outside of Budapest differs significantly. 